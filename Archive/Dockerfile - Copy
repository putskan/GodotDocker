FROM nginx: 1.17.9

COPY default.conf.template /etc/nginx/conf.d/default.conf.template
COPY nginx.conf /etc/nginx/nginx.conf
COPY static-html /usr/share/nginx/html
RUN mkdir -p /usr/share/nginx/html/data
COPY data-html /usr/share/nginx/html/data

WORKDIR /home/pub/
COPY ./Godot_v3.2 /home/pub/Godot_v3.2
COPY ./wsmtpler.pck /home/pub/wsmtpler.pck
#COPY ./wsmtplr.x86_64 /home/pub/wsmtplr.x86_64
RUN chmod +x Godot_v3.2
ENV PATH = "/home/pub/:${PATH}"

#CMD /bin/bash -c "envsubst '\$PORT' < /etc/nginx/conf.d/default.conf.template > /etc/nginx/conf.d/default ........
#CMD ["sh","-c","./godot.sh"]
#CMD /bin/bash -c ./godot.sh
CMD /bin/bash -c "envsubst '\$PORT' < /etc/nginx/conf.d/default.conf.template > /etc/nginx/conf.d/default.conf" && nginx && ./Godot_v3.2 -s --main-pack wsmtpler.pck